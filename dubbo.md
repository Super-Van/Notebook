# dubbo

## 分布式系统

根据《分布式系统原理与范型》的定义，分布式系统是若干独立计算机的集合，这些计算机对用户来说就像单个相关系统。

比如我们浏览京东的时候，在几个页面间跳来跳去，感觉是就只有一个完整系统为我们服务，但其背后存在着成千上万台独立的计算机为我们服务，那么这些计算机合起来构成完整的京东商城系统。

分布式系统（distributed system）是建立在网络之上的软件系统，即是说没有网络的话分布式系统也不存在。

随着互联网的发展，网站应用的规模越来越大，功能也越来越多，常规的垂直应用架构已无力负载得起来（如每年双十一，淘宝系统每秒要处理上万甚至上亿的请求，分布式服务架构以及流动计算架构势在必行。

那么我们就不难想出将各个功能模块放到不同的计算机上，然后让它们共同工作，来抵御大规模的流量。另外我们注意到，这些小的功能模块之间也会有联系，即互相调用，于是这些联系也需要系统进行维护。

## 应用架构的演变

可参考[dubbo-入门-背景](https://dubbo.apache.org/zh/docs/v2.7/user/preface/background/)。里面的内容详细介绍了从单一应用架构（orm）到垂直应用架构（mnv）再到分布式服务架构（rpc）最后到流动计算架构（soa）的发展。

理解一下各阶段的问题：

- 单一应用架构：几大模块在同一个应用（项目）中，互相访问，就带来互相掣肘，高耦合。当要改某个模块，整个项目就得停掉，所以扩展起来很麻烦。

- 垂直应用架构：几个模块分散到不同工程中，且各自可以复制多份，共同组成一个大项目。如此各模块功能的扩展不必影响其他模块。但它仍存在问题，即各模块内部前后端（界面和业务逻辑）之间存在耦合，需要分离；此外发现各模块之间的交互访问依旧不可规避。

- 分布式服务架构：将各模块的界面和业务逻辑划分开，于是它们可以互相访问，比如下图这个例子。

  ![image-20210720172117585](D:\chaofan\typora\专业\dubbo.assets\image-20210720172117585.png)

  之后我们又会碰到一个问题：用户web在A服务器上，用户业务在B服务器上，订单业务放在C服务器上……，那么身居不同服务器上，用户web如何调用订单业务呢？由此引出RPC（Remote Procedure Call)-远程过程调用。所以，一个好的分布式服务架构应该做到实现RPC。

- 流动计算架构：此架构致力于在多台服务器承载同一模块的条件下，根据当前用户请求情况动态地分发请求，让相对闲置的服务器多处理，相对忙碌的服务器少处理，这叫基于访问压力实时管理集群容量，提高集群的利用率。

架构的变化必然引起技术的兴起。

## RPC

rpc是一种进程间的通信方式（跨服务器），是一种技术思想，而不是规范。具体来说，它使得程序调用另一个地址空间（通常这个地址空间在共享网络的另一台机器上）的过程或函数，好处就在于不用程序员显式实现这个远程调用的细节，即程序员无论调用本地还是远程的函数，调用的代码在形式上是基本相同的。

下面是一个跨服务器调用的时序图：

![时序图](https://img-blog.csdnimg.cn/20190923151223905.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzMzNDIzNDE4,size_16,color_FFFFFF,t_70)

从上图可看出影响rpc效率的主要在于服务器之间连接的建立与序列化反序列化的速度。

常见rpc框架包括dubbo、gRPC、Thrift、HSF。

这是[rpc官网](https://dubbo.apache.org/zh/)。

## 注册中心

### 概念

为了动态感知诸服务器的状态，我们引入一种注册中心的机制。

我们可以将所有的界面和业务逻辑都注册到注册中心里面，那么注册中心相当于维护了一个清单，明细各界面和业务逻辑都在哪些服务器上，并监控各服务器的状态和当中服务的状态。当程序发起一个rpc时，会先由注册中心告知目标服务在哪些服务器上，然后根据负载均衡机制选定其中一个服务器建立通信、传递数据、远程调用。

注册中心还提供了可视化界面，展现各服务的健康状况、调用统计等等。

### dubbo架构

官方文档[dubbo架构](https://dubbo.apache.org/zh/docs/v2.7/user/preface/architecture/)给了详细说明。着重理解下面这张图：

<img src="https://dubbo.apache.org/imgs/user/dubbo-architecture.jpg" alt="dubbo-architucture" style="zoom:150%;" />

### zookeeper

dubbo支持好几种注册中心，推荐使用zookeeper。

下载可以去镜像下。